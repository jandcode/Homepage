<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anleitung: High-End Framer Cookie Banner mit GA4 & Meta Logic</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script>hljs.highlightAll();</script>
    <style>
        :root {
            --bg-guide: #fbfbfd;
            --code-bg: #1e1e1e;
            --accent-orange: #E84511;
        }

        body {
            background-color: var(--bg-guide);
            color: #1d1d1f;
        }

        .guide-container {
            max-width: 900px;
            margin: 60px auto;
            padding: 0 30px;
        }

        .guide-header {
            margin-bottom: 40px;
            text-align: left;
        }

        .guide-content h2 {
            font-size: 2rem;
            margin: 20px 0 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .step-box h2:first-child {
            margin-top: 0;
        }

        .guide-content h3 {
            font-size: 1.4rem;
            margin: 30px 0 15px;
            font-weight: 600;
        }

        .guide-content p,
        .guide-content li {
            font-size: 1.15rem;
            line-height: 1.7;
            color: #424245;
            margin-bottom: 20px;
        }

        .guide-content ul,
        .guide-content ol {
            margin-bottom: 25px;
            padding-left: 20px;
        }

        .step-box {
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
        }

        .warning-box {
            background: #fff5f2;
            border-left: 4px solid var(--accent-orange);
            padding: 24px;
            border-radius: 12px;
            margin: 25px 0;
        }

        .warning-box strong {
            color: var(--accent-orange);
        }

        pre {
            background: var(--code-bg);
            color: #d4d4d4;
            padding: 24px;
            border-radius: 16px;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        code {
            font-family: 'Fira Code', monospace;
        }

        .accent {
            color: var(--accent-blue);
            font-weight: 600;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--text-muted);
            font-weight: 500;
            margin-bottom: 40px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: var(--text-main);
        }

        .copy-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: -15px;
            margin-bottom: 20px;
            display: block;
        }

        /* Scrollable Code Window & Copy Button */
        .code-container {
            position: relative;
            margin: 25px 0;
        }

        pre {
            background: var(--code-bg);
            color: #d4d4d4;
            padding: 24px;
            border-radius: 16px;
            overflow: auto;
            max-height: 400px;
            /* Kleinere H√∂he */
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        pre::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        pre::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(4px);
            transition: all 0.2s ease;
            z-index: 10;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: #22c55e;
            border-color: #22c55e;
        }
    </style>
</head>

<body>
    <div class="background-liquid" style="opacity: 0.3;">
        <div class="blob blob-1"></div>
        <div class="blob blob-2" style="background: var(--accent-orange); opacity: 0.1;"></div>
    </div>

    <div class="guide-container">
        <a href="/" class="back-link">‚Üê Zur√ºck zur Homepage</a>

        <header class="guide-header">
            <div class="badge" style="background: rgba(232, 69, 17, 0.1); color: var(--accent-orange);">Advanced Guide
            </div>
            <h1 class="headline" style="text-align: left; font-size: 3.5rem;">Framer Cookie Manager Pro.</h1>
            <p class="subheadline" style="text-align: left; margin-left: 0;">Setup GA4 & Meta Pixel mit einem
                DSGVO-konformen Slider-System.</p>
        </header>

        <div class="guide-content">
            <section class="step-box">
                <h2>Schritt 1: Code erstellen (CookieManager.tsx)</h2>
                <p>Erstelle ein neues Code-File in Framer (<span class="accent">Assets > Code > New File</span>), nenne
                    es <span class="accent">CookieManager.tsx</span> und kopiere diesen vollst√§ndigen React-Code hinein.
                </p>

                <div class="code-container">
                    <button class="copy-btn" id="copyBtn">Code kopieren</button>
                    <pre><code id="codeBlock" class="language-typescript">import { useEffect, useState, MouseEvent, useCallback, useMemo } from "react"
import { addPropertyControls, ControlType } from "framer"

/**
 * üëª PRIVACY SLIDER (Community Edition)
 * Ein "Privacy by Design" Experiment f√ºr Framer.
 * * ANLEITUNG:
 * 1. Ziehe die Komponente auf dein Overlay oder Footer.
 * 2. Sidebar: Trage deine GA4 &amp; Pixel IDs ein.
 * 3. Sidebar: Setze die Links zu Datenschutz &amp; Impressum.
 */

declare global {
    interface Window { fbq: any; _fbq: any; dataLayer: any; }
}

interface Props {
    googleAnalyticsID: string
    metaPixelID: string
    accentColor: string
    privacyLink: string
    imprintLink: string
    startClosed: boolean
}

export default function CookieManager(props: Props) {
    // Startet immer im Ghost Mode (Privacy by Default)
    const [sliderValue, setSliderValue] = useState(0)
    const [status, setStatus] = useState&lt;"undecided" | "decided"&gt;("undecided")

    const modeConfig = useMemo(() =&gt; [
        {
            label: "Ghost Mode",
            desc: "Kein Tracking. Nur essenzielle Cookies.", 
            emoji: "üëª",
            color: "#EFEBE5",
            textColor: "#000000",
            consent: "false",
        },
        {
            label: "Full Support",
            desc: "Aktiviert Google Analytics &amp; Meta Pixel.", // Wichtig: Anbieter nennen!
            emoji: "‚ù§Ô∏è",
            color: props.accentColor,
            textColor: "#FFFFFF",
            consent: "true",
        }
    ], [props.accentColor])

    const current = modeConfig[sliderValue]

    const loadTrackingScripts = useCallback(() =&gt; {
        if (typeof window === "undefined") return
        
        // GA4 Logic
        if (props.googleAnalyticsID && !document.getElementById("ga-script")) {
            const s = document.createElement("script"); s.id = "ga-script"; s.async = true
            s.src = `https://www.googletagmanager.com/gtag/js?id=${props.googleAnalyticsID}`
            document.head.appendChild(s)
            window.dataLayer = window.dataLayer || []
            const gtag = (...args: any[]) =&gt; window.dataLayer.push(args)
            gtag("js", new Date()); gtag("config", props.googleAnalyticsID)
        }

        // Meta Pixel Logic
        if (props.metaPixelID && !document.getElementById("meta-pixel-marker")) {
            !(function(f:any,b:any,e:any,v:any,n:any,t:any,s:any){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)})(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
            window.fbq('init', props.metaPixelID); window.fbq('track', 'PageView')
            const m = document.createElement("div"); m.id = "meta-pixel-marker"; document.body.appendChild(m)
        }
    }, [props.googleAnalyticsID, props.metaPixelID])

    useEffect(() =&gt; {
        const consent = localStorage.getItem("consent_granted")
        // Logik: Nur anzeigen, wenn noch nicht entschieden
        if (consent === "true") { setStatus("decided"); loadTrackingScripts() }
        else if (consent === "false") { setStatus("decided") }
        else { setStatus("undecided") }
    }, [loadTrackingScripts])

    const handleConfirm = (e: MouseEvent) =&gt; {
        e.preventDefault(); e.stopPropagation()
        localStorage.setItem("consent_granted", current.consent)
        setStatus("decided")
        
        if (current.consent === "true") { 
            requestAnimationFrame(() =&gt; setTimeout(loadTrackingScripts, 50)) 
        }
    }

    // Zeigt Komponente nur, wenn undecided ODER wenn im Editor "Start Closed" deaktiviert ist (zum Testen)
    if (status !== "undecided" &amp;&amp; !props.startClosed) return null

    return (
        &lt;div style={styles.container}&gt;
            &lt;style&gt;{`
                .privacy-slider {
                    -webkit-appearance: none; width: 100%; height: 44px;
                    background: #F1F1F1; border-radius: 22px; outline: none;
                    padding: 0 6px; cursor: pointer; transition: background 0.3s ease;
                }
                .privacy-slider::-webkit-slider-thumb {
                    -webkit-appearance: none; width: 32px; height: 32px;
                    background: white; border-radius: 50%;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                }
                .privacy-slider::-webkit-slider-thumb:hover { transform: scale(1.1); }
            `}&lt;/style&gt;

            &lt;div style={styles.header}&gt;
                &lt;div style={{...styles.emojiBadge, background: sliderValue === 0 ? "#F8F8F8" : props.accentColor + "15"}}&gt;
                    &lt;span style={styles.emoji}&gt;{current.emoji}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div style={styles.textContainer}&gt;
                    &lt;h4 style={styles.title}&gt;{current.label}&lt;/h4&gt;
                    &lt;p style={styles.desc}&gt;{current.desc}&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;input 
                type="range" min="0" max="1" step="1" 
                value={sliderValue}
                onChange={(e) =&gt; setSliderValue(parseInt(e.target.value))}
                className="privacy-slider"
                style={{ background: sliderValue === 1 ? props.accentColor + "25" : "#E5E5E5" }}
            /&gt;

            &lt;button
                onClick={handleConfirm}
                style={{ 
                    ...styles.button, 
                    background: current.color, 
                    color: current.textColor,
                    border: sliderValue === 0 ? "1px solid #E0DCD6" : "none"
                }}
            &gt;
                Auswahl best√§tigen
            &lt;/button&gt;

            &lt;div style={styles.footerLinks}&gt;
                &lt;a href={props.privacyLink} style={styles.link}&gt;Datenschutz&lt;/a&gt;
                &lt;span style={{color: "#ccc"}}&gt;‚Ä¢&lt;/span&gt;
                &lt;a href={props.imprintLink} style={styles.link}&gt;Impressum&lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    )
}

const styles: any = {
    container: {
        position: "fixed", bottom: "32px", right: "32px", 
        width: "90%", maxWidth: "320px", background: "#FFFFFF",
        borderRadius: "32px", boxShadow: "0 25px 60px rgba(0,0,0,0.2)",
        zIndex: 2147483647, padding: "24px", 
        fontFamily: "-apple-system, BlinkMacSystemFont, sans-serif",
        display: "flex", flexDirection: "column", gap: "20px",
        border: "1px solid #F0F0F0"
    },
    header: { display: "flex", flexDirection: "row", alignItems: "center", gap: "16px" },
    emojiBadge: { minWidth: "64px", minHeight: "64px", borderRadius: "20px", display: "flex", alignItems: "center", justifyContent: "center", transition: "all 0.3s" },
    emoji: { fontSize: "32px" },
    textContainer: { display: "flex", flexDirection: "column", gap: "2px" },
    title: { margin: 0, fontSize: "18px", fontWeight: "800", color: "#000" },
    desc: { margin: 0, fontSize: "13px", color: "#888", fontWeight: "500", lineHeight: "1.4" },
    button: { border: "none", padding: "16px", borderRadius: "18px", cursor: "pointer", fontWeight: "700", fontSize: "14px", transition: "all 0.3s ease", marginTop: "4px" },
    footerLinks: { display: "flex", justifyContent: "center", gap: "8px", fontSize: "11px", color: "#999", marginTop: "4px" },
    link: { color: "#999", textDecoration: "none", cursor: "pointer" }
}

addPropertyControls(CookieManager, {
    googleAnalyticsID: { type: ControlType.String, title: "GA4 ID", placeholder: "G-XXXXXXXX" },
    metaPixelID: { type: ControlType.String, title: "Meta Pixel", placeholder: "12345678" },
    accentColor: { type: ControlType.Color, title: "Brand Color", defaultValue: "#E84511" },
    privacyLink: { type: ControlType.String, title: "Privacy Link", defaultValue: "/datenschutz" },
    imprintLink: { type: ControlType.String, title: "Imprint Link", defaultValue: "/impressum" },
    startClosed: { type: ControlType.Boolean, title: "Debug: Show?", defaultValue: false, enabledTitle: "Force Show", disabledTitle: "Auto" },
})</code></pre>
                </div>
            </section>

            <section class="step-box">
                <h2>Schritt 2: Der Widerruf (Footer Reset)</h2>
                <p>Damit es DSGVO-konform ist (Widerrufsrecht), muss der Nutzer seine Entscheidung jederzeit √§ndern
                    k√∂nnen.</p>
                <p>Erstelle eine neue Code Datei in <strong>Overrides</strong> (z.B. <span
                        class="accent">CookieReset.tsx</span>) und f√ºge diesen Code ein:</p>
                <div class="code-container">
                    <pre><code class="language-typescript">import { ComponentType } from "react"

export function CookieReset(Component): ComponentType {
    return (props: any) =&gt; {
        return (
            &lt;Component
                {...props}
                style={{ ...props.style, cursor: "pointer" }}
                onClick={(e: any) =&gt; {
                    e.preventDefault()
                    // L√∂scht die Entscheidung
                    localStorage.removeItem("consent_granted")
                    // L√§dt die Seite neu -&gt; Banner erscheint
                    window.location.reload()
                }}
            /&gt;
        )
    }
}</code></pre>
                </div>
                <h3>Verbindung in Framer:</h3>
                <ol>
                    <li><strong>Textzeile einf√ºgen:</strong> Schreibe irgendwo in deinen Footer einen Text wie
                        "Cookie-Einstellungen".</li>
                    <li><strong>Text ausw√§hlen:</strong> Klicke diesen Text auf dem Canvas an.</li>
                    <li><strong>Code Overrides finden:</strong> Schau ganz unten rechts in der Seitenleiste nach der
                        Sektion "Code Overrides".</li>
                    <li><strong>Override hinzuf√ºgen:</strong> Klicke auf das kleine <strong>+</strong> Zeichen.</li>
                    <li><strong>Einstellen:</strong> W√§hle bei File: <strong>CookieReset</strong> und bei Override:
                        <strong>CookieReset</strong>.
                    </li>
                </ol>
            </section>

            <section class="step-box">
                <h2>Schritt 3: Setup in Framer</h2>
                <h3>1. Komponente platzieren</h3>
                <p>Ziehe die <span class="accent">CookieManager</span> Komponente auf deinen Canvas.</p>
                <div class="warning-box">
                    <strong>Wichtig:</strong> Platziere sie am besten in deiner <strong>Navigation-Komponente</strong>
                    oder deinem <strong>Footer</strong>. Warum? Diese Komponenten sind meistens auf allen Seiten
                    vorhanden. Wenn du es nur auf der Home-Seite einf√ºgst, wird das Cookie-Banner auf Unterseiten nicht
                    geladen (und Analytics auch nicht, selbst wenn Consent da w√§re).
                </div>

                <h3>2. IDs eintragen</h3>
                <p>Klicke die Komponente an und trage rechts in den Properties deine <code
                        class="accent">G-XXXXXX</code> und <code class="accent">Meta Pixel ID</code> ein.</p>

                <h3>3. Site Settings s√§ubern (Kritisch!)</h3>
                <p>Gehe in die Framer Site Settings ‚Üí General ‚Üí Custom Code. L√∂sche alles raus, was mit Google Analytics
                    oder Meta zu tun hat. Wenn der Code dort drin steht, l√§dt er sofort beim Seitenstart, egal was dein
                    React-Code macht. Das ist der h√§ufigste Fehler.</p>
            </section>

            <section class="step-box">
                <h2>Schritt 4: Publish & Test</h2>
                <ol>
                    <li>√ñffne die Seite im <strong>Incognito Tab</strong>.</li>
                    <li>Banner sollte erscheinen.</li>
                    <li>√ñffne <strong>DevTools (F12) ‚Üí Network</strong>.</li>
                    <li>Suche nach "google" oder "collect". Es sollte nichts zu sehen sein.</li>
                    <li>Klicke <strong>"Auswahl best√§tigen"</strong> (im Full Support Modus).</li>
                    <li>Jetzt sollten die Requests im Network-Tab auftauchen.</li>
                </ol>
            </section>

            <section class="step-box">
                <h2>Erweiterte Dev-Tipps</h2>
                <ul>
                    <li><strong>TypeScript Errors:</strong> Framer's Editor meckert manchmal bei
                        <code>window.dataLayer</code> oder <code>window.fbq</code>. Der Code oben enth√§lt bereits die
                        <code>declare global</code> Definition, um dies zu fixen.
                    </li>
                    <li><strong>GTM (Tag Manager):</strong> Wenn du den Google Tag Manager (GTM) nutzt statt direkt GA4,
                        √§nderst du die URL im <code>script.src</code> einfach auf die GTM-Url. Die Logik bleibt
                        identisch.</li>
                    <li><strong>Re-Render Safety:</strong> Der <code>useEffect</code> l√§uft beim Navigieren in Framer
                        nicht st√§ndig neu, wenn die Komponente im Wrapper (Nav/Footer) liegt, der persistent bleibt. Der
                        Check auf vorhandene Script-IDs verhindert doppeltes Laden.</li>
                </ul>
            </section>

            <section class="step-box" style="background: #111; color: #fff; border: none; margin-top: 80px;">
                <h2 style="color: #fff; margin-top: 0;">Keine Zeit f√ºr den Einbau?</h2>
                <p style="color: #ccc;">
                    Oder hast du ein komplexeres Problem in Framer, Shopify oder bei deinem Tracking-Setup?
                    Ich begleite Agenturen und Marken als Tech-Partner bei der Umsetzung anspruchsvoller Web-Projekte.
                </p>
                <div style="margin-top: 30px; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                    <a href="/#contact" class="btn-primary"
                        style="background: var(--accent-orange); color: #fff; padding: 16px 32px; border-radius: 12px; text-decoration: none; font-weight: 700; display: inline-flex; align-items: center; gap: 10px;">
                        15-Min Tech-Check buchen ‚Üí
                    </a>
                    <p style="margin: 0; font-size: 0.9rem; color: #888;">Komplett kostenlos & unverbindlich.</p>
                </div>
            </section>

            <footer
                style="margin-top: 80px; padding: 40px 0; border-top: 1px solid rgba(0,0,0,0.05); text-align: center;">
                <p>Tech-Support von <a href="/" class="accent" style="color: #111;">Jan Dorbath</a></p>
                <a class="cookie-reset-link" style="margin-top: 20px;">Cookie-Einstellungen</a>
            </footer>
        </div>
    </div>
    <script>
        document.getElementById('copyBtn').addEventListener('click', function () {
            const code = document.getElementById('codeBlock').innerText;
            const btn = this;

            navigator.clipboard.writeText(code).then(() => {
                btn.innerText = 'Kopiert!';
                btn.classList.add('copied');

                setTimeout(() => {
                    btn.innerText = 'Code kopieren';
                    btn.classList.remove('copied');
                }, 2000);
            });
        });
    </script>
    <script src="translations.js"></script>
    <script src="script.js"></script>
</body>

</html>